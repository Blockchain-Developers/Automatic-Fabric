<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Cathay BC Services</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/styles.css">
</head>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/js/jquery.min.js"></script>
<script src="assets/js/openpgp.min.js"></script>
<script type="text/javascript">
	$(function () {
        var generateKeys = async function () {
			document.getElementById('generate').disabled = true;
			document.getElementById('generate').textContent = 'Generating Keypair';
            var dt = new Date();
            var time = -(dt.getTime());
			const { privateKeyArmored, publicKeyArmored, revocationCertificate } = await openpgp.generateKey({
				userIds: [{name: 'test1', email: 'test1@cathaybcservices.com'}],
				rsaBits: 4096,
				passphrase: ''
			});
            $('#time-report').text('.');
            dt = new Date();
            time += (dt.getTime());
            $('#time-report').text('Generated in ' + time + ' ms');
            $('#pubkey').val(publicKeyArmored);
			var prvkey = privateKeyArmored;
			var data = new Blob([prvkey], {type: 'application/octet-stream'});
			var url = window.URL.createObjectURL(data);
			document.getElementById('downloadkey').href = url;
			$('#generate').hide();
			$('#sendkey').show();
			$('#downloadkey').show();
        };
		$('#sendkey').hide();
		$('#downloadkey').hide();
        $('#generate').click(generateKeys);
    });
</script>
<div>
    <div class="container" style="width: 80%;height: 60%;">
        <div class="row">
            <div class="col-md-6" style="max-width: 20%;margin-top: 98px"></div>
            <div class="col-md-6" style="max-width: 60%;min-width: 60%;text-align:center">
                <h1 class="text-center" style="margin-top: 20px;">Keypair Generator</h1>
                <p style="text-align:justify">This is your first login, a RSA keypair will be generated. Please download and save the key securely, since the key is unrecoverable and will result in deny of access to certain services in the event of key loss. The key generation process is done locally with only the public key sent to our servers</p>
                <button class="btn btn-light" id="generate">Generate Keypair</button>
				<a id="downloadkey" class="btn-lg btn-secondary" role="button" href="" style="">Download Private Key</a><br>
				<small id="time-report"></small>
				<form role='form' autocomplete='off' method='post' enctype='application/json' action='/writekey'>
					<textarea class="form-control" id="pubkey" name="pubkey" readonly hidden></textarea>
					<button id="sendkey" class="btn btn-danger" type="submit" style="margin-top:20px">I have securely saved the key</button>
				</form>
            <div class="col-md-6" style="max-width: 20%;margin-top: 80px"></div>
        </div>
    </div>
</div>